!function(e){var p=function(b,a){this.$ns="bootstrap-markdown";this.$element=e(b);this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null};this.$options=e.extend(!0,{},e.fn.markdown.defaults,a,this.$element.data(),this.$element.data("options"));this.$oldContent=null;this.$isFullscreen=this.$isPreview=!1;this.$textarea=this.$editor=null;this.$handler=[];this.$callback=[];this.$nextTab=[];this.showEditor()};p.prototype={constructor:p,__alterButtons:function(b,a){var c="all"==b,d=this;
e.each(this.$handler,function(e,m){0==(c?!1:0>m.indexOf(b))&&a(d.$editor.find('button[data-handler="'+m+'"]'))})},__buildButtons:function(b,a){var c,d=this.$ns,q=this.$handler,m=this.$callback;for(c=0;c<b.length;c++){var f,k=b[c];for(f=0;f<k.length;f++){var l,g=k[f].data,n=e("<div/>",{"class":"btn-group"});for(l=0;l<g.length;l++){var h=g[l],x=d+"-"+h.name,y=this.__getIcon(h.icon);var p=h.btnText?h.btnText:"";var t=h.btnClass?h.btnClass:"btn",v=h.tabIndex?h.tabIndex:"-1",u="undefined"!==typeof h.hotkey?
h.hotkey:"",w="undefined"!==typeof jQuery.hotkeys&&""!==u?" ("+u+")":"";var r=e("<button></button>");r.text(" "+this.__localize(p)).addClass("btn-default btn-sm").addClass(t);t.match(/btn\-(primary|success|info|warning|danger|link)/)&&r.removeClass("btn-default");r.attr({type:"button",title:this.__localize(h.title)+w,tabindex:v,"data-provider":d,"data-handler":x,"data-hotkey":u});1==h.toggle&&r.attr("data-toggle","button");p=e("<span/>");p.addClass(y);p.prependTo(r);n.append(r);q.push(x);m.push(h.callback)}a.append(n)}}return a},
__setListener:function(){var b="undefined"!=typeof this.$textarea.attr("rows"),a=5<this.$textarea.val().split("\n").length?this.$textarea.val().split("\n").length:"5";b=b?this.$textarea.attr("rows"):a;this.$textarea.attr("rows",b);this.$options.resize&&this.$textarea.css("resize",this.$options.resize);this.$textarea.on("focus",e.proxy(this.focus,this)).on("keypress",e.proxy(this.keypress,this)).on("keyup",e.proxy(this.keyup,this)).on("change",e.proxy(this.change,this));if(this.eventSupported("keydown"))this.$textarea.on("keydown",
e.proxy(this.keydown,this));this.$textarea.data("markdown",this)},__handle:function(b){var a=e(b.currentTarget),c=this.$handler,d=this.$callback;a=a.attr("data-handler");c=c.indexOf(a);d=d[c];e(b.currentTarget).focus();d(this);this.change(this);0>a.indexOf("cmdSave")&&this.$textarea.focus();b.preventDefault()},__localize:function(b){var a=e.fn.markdown.messages,c=this.$options.language;return"undefined"!==typeof a&&"undefined"!==typeof a[c]&&"undefined"!==typeof a[c][b]?a[c][b]:b},__getIcon:function(b){return"object"==
typeof b?b[this.$options.iconlibrary]:b},setFullscreen:function(b){var a=this.$editor,c=this.$textarea;!0===b?(a.addClass("md-fullscreen-mode"),e("body").addClass("md-nooverflow"),this.$options.onFullscreen(this)):(a.removeClass("md-fullscreen-mode"),e("body").removeClass("md-nooverflow"));this.$isFullscreen=b;c.focus()},showEditor:function(){var b=this,a=this.$ns,c=this.$element;c.css("height");c.css("width");var d=this.$editable,q=this.$handler,m=this.$callback,f=this.$options,k=e("<div/>",{"class":"md-editor",
click:function(){b.focus()}});if(null==this.$editor){var l=e("<div/>",{"class":"md-header btn-toolbar"}),g=[];0<f.buttons.length&&(g=g.concat(f.buttons[0]));0<f.additionalButtons.length&&(g=g.concat(f.additionalButtons[0]));0<f.reorderButtonGroups.length&&(g=g.filter(function(a){return-1<f.reorderButtonGroups.indexOf(a.name)}).sort(function(a,b){return f.reorderButtonGroups.indexOf(a.name)<f.reorderButtonGroups.indexOf(b.name)?-1:f.reorderButtonGroups.indexOf(a.name)>f.reorderButtonGroups.indexOf(b.name)?
1:0}));0<g.length&&(l=this.__buildButtons([g],l));if(f.fullscreen.enable)l.append('<div class="md-controls"><a class="md-control md-control-fullscreen" href="#"><span class="'+this.__getIcon(f.fullscreen.icons.fullscreenOn)+'"></span></a></div>').on("click",".md-control-fullscreen",function(a){a.preventDefault();b.setFullscreen(!0)});k.append(l);if(c.is("textarea")){c.before(k);var n=c;n.addClass("md-input");k.append(n)}else g="function"==typeof toMarkdown?toMarkdown(c.html()):c.html(),g=e.trim(g),
n=e("<textarea/>",{"class":"md-input",val:g}),k.append(n),d.el=c,d.type=c.prop("tagName").toLowerCase(),d.content=c.html(),e(c[0].attributes).each(function(){d.attrKeys.push(this.nodeName);d.attrValues.push(this.nodeValue)}),c.replaceWith(k);c=e("<div/>",{"class":"md-footer"});g=!1;var h="";f.savable&&(g=!0,q.push("cmdSave"),m.push(f.onSave),c.append('<button class="btn btn-success" data-provider="'+a+'" data-handler="cmdSave"><i class="icon icon-white icon-ok"></i> '+this.__localize("Save")+"</button>"));
h="function"===typeof f.footer?f.footer(this):f.footer;""!==e.trim(h)&&(g=!0,c.append(h));g&&k.append(c);f.width&&"inherit"!==f.width&&(jQuery.isNumeric(f.width)?(k.css("display","table"),n.css("width",f.width+"px")):k.addClass(f.width));f.height&&"inherit"!==f.height&&(jQuery.isNumeric(f.height)?(a=f.height,l&&(a=Math.max(0,a-l.outerHeight())),c&&(a=Math.max(0,a-c.outerHeight())),n.css("height",a+"px")):k.addClass(f.height));this.$editor=k;this.$textarea=n;this.$editable=d;this.$oldContent=this.getContent();
this.__setListener();this.$editor.attr("id",(new Date).getTime());this.$editor.on("click",'[data-provider="bootstrap-markdown"]',e.proxy(this.__handle,this));if(this.$element.is(":disabled")||this.$element.is("[readonly]"))this.$editor.addClass("md-editor-disabled"),this.disableButtons("all");this.eventSupported("keydown")&&"object"===typeof jQuery.hotkeys&&l.find('[data-provider="bootstrap-markdown"]').each(function(){var a=e(this),b=a.attr("data-hotkey");""!==b.toLowerCase()&&n.bind("keydown",b,
function(){a.trigger("click");return!1})});"preview"===f.initialstate?this.showPreview():"fullscreen"===f.initialstate&&f.fullscreen.enable&&this.setFullscreen(!0)}else this.$editor.show();f.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active"));f.fullscreen.enable&&!1!==f.fullscreen&&(this.$editor.append('          <div class="md-fullscreen-controls">            <a href="#" class="exit-fullscreen" title="Exit fullscreen"><span class="'+this.__getIcon(f.fullscreen.icons.fullscreenOff)+
'"></span></a>          </div>'),this.$editor.on("click",".exit-fullscreen",function(a){a.preventDefault();b.setFullscreen(!1)}));this.hideButtons(f.hiddenButtons);this.disableButtons(f.disabledButtons);f.onShow(this);return this},parseContent:function(){var b=this.$options.onPreview(this);"string"!=typeof b&&(b=this.$textarea.val(),b="object"==typeof markdown?markdown.toHTML(b):"function"==typeof marked?marked(b):b);return b},showPreview:function(){var b=this.$textarea,a=b.next(),c=e("<div/>",{"class":"md-preview",
"data-provider":"markdown-preview"});this.$isPreview=!0;this.disableButtons("all").enableButtons("cmdPreview");var d=this.parseContent();c.html(d);a&&"md-footer"==a.attr("class")?c.insertBefore(a):b.parent().append(c);c.css({width:b.outerWidth()+"px",height:b.outerHeight()+"px"});this.$options.resize&&c.css("resize",this.$options.resize);b.hide();c.data("markdown",this);if(this.$element.is(":disabled")||this.$element.is("[readonly]"))this.$editor.addClass("md-editor-disabled"),this.disableButtons("all");
return this},hidePreview:function(){this.$isPreview=!1;this.$editor.find('div[data-provider="markdown-preview"]').remove();this.enableButtons("all");this.disableButtons(this.$options.disabledButtons);this.$textarea.show();this.__setListener();return this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(b){this.$textarea.val(b);return this},findSelection:function(b){var a;if(a=this.getContent().indexOf(b),0<=a&&0<
b.length){var c=this.getSelection();this.setSelection(a,a+b.length);b=this.getSelection();this.setSelection(c.start,c.end);return b}return null},getSelection:function(){var b=this.$textarea[0];return("selectionStart"in b&&function(){var a=b.selectionEnd-b.selectionStart;return{start:b.selectionStart,end:b.selectionEnd,length:a,text:b.value.substr(b.selectionStart,a)}}||function(){return null})()},setSelection:function(b,a){var c=this.$textarea[0];return("selectionStart"in c&&function(){c.selectionStart=
b;c.selectionEnd=a}||function(){return null})()},replaceSelection:function(b){var a=this.$textarea[0];return("selectionStart"in a&&function(){a.value=a.value.substr(0,a.selectionStart)+b+a.value.substr(a.selectionEnd,a.value.length);a.selectionStart=a.value.length;return this}||function(){a.value+=b;return jQuery(a)})()},getNextTab:function(){if(0==this.$nextTab.length)return null;var b,a=this.$nextTab.shift();"function"==typeof a?b=a():"object"==typeof a&&0<a.length&&(b=a);return b},setNextTab:function(b,
a){if("string"==typeof b){var c=this;this.$nextTab.push(function(){return c.findSelection(b)})}else if("number"==typeof b&&"number"==typeof a){var d=this.getSelection();this.setSelection(b,a);this.$nextTab.push(this.getSelection());this.setSelection(d.start,d.end)}},__parseButtonNameParam:function(b){var a=[];"string"==typeof b?a.push(b):a=b;return a},enableButtons:function(b){var a=this.__parseButtonNameParam(b),c=this;e.each(a,function(b,e){c.__alterButtons(a[b],function(a){a.removeAttr("disabled")})});
return this},disableButtons:function(b){var a=this.__parseButtonNameParam(b),c=this;e.each(a,function(b,e){c.__alterButtons(a[b],function(a){a.attr("disabled","disabled")})});return this},hideButtons:function(b){var a=this.__parseButtonNameParam(b),c=this;e.each(a,function(b,e){c.__alterButtons(a[b],function(a){a.addClass("hidden")})});return this},showButtons:function(b){var a=this.__parseButtonNameParam(b),c=this;e.each(a,function(b,e){c.__alterButtons(a[b],function(a){a.removeClass("hidden")})});
return this},eventSupported:function(b){var a=b in this.$element;a||(this.$element.setAttribute(b,"return;"),a="function"===typeof this.$element[b]);return a},keyup:function(b){var a=!1;switch(b.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var c;if(c=this.getNextTab(),null!=c){var d=this;setTimeout(function(){d.setSelection(c.start,c.end)},500);a=!0}else a=this.getSelection(),a.start==a.end&&a.end==this.getContent().length?a=!1:(this.setSelection(this.getContent().length,this.getContent().length),
a=!0);break;case 13:a=!1;break;case 27:this.$isFullscreen&&this.setFullscreen(!1);a=!1;break;default:a=!1}a&&(b.stopPropagation(),b.preventDefault());this.$options.onChange(this)},change:function(b){this.$options.onChange(this);return this},focus:function(b){b=this.$options;var a=this.$editor;a.addClass("active");e(document).find(".md-editor").each(function(){if(e(this).attr("id")!=a.attr("id")){var b;if(b=e(this).find("textarea").data("markdown"),null==b)b=e(this).find('div[data-provider="markdown-preview"]').data("markdown");
b&&b.blur()}});b.onFocus(this);return this},blur:function(b){b=this.$options;var a=b.hideable,c=this.$editor,d=this.$editable;if(c.hasClass("active")||0==this.$element.parent().length){c.removeClass("active");if(a)if(null!=d.el){var q=e("<"+d.type+"/>");a=this.getContent();a="object"==typeof markdown?markdown.toHTML(a):a;e(d.attrKeys).each(function(a,b){q.attr(d.attrKeys[a],d.attrValues[a])});q.html(a);c.replaceWith(q)}else c.hide();b.onBlur(this)}return this}};var v=e.fn.markdown;e.fn.markdown=function(b){return this.each(function(){var a=
e(this),c=a.data("markdown"),d="object"==typeof b&&b;c||a.data("markdown",new p(this,d))})};e.fn.markdown.messages={};e.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",resize:"none",iconlibrary:"glyph",language:"en",initialstate:"editor",buttons:[[{name:"groupFont",data:[{name:"cmdBold",hotkey:"Ctrl+B",title:"Bold",icon:{glyph:"glyphicon glyphicon-bold",fa:"fa fa-bold","fa-3":"icon-bold"},callback:function(b){var a=b.getSelection();var c=b.getContent();var d=
0==a.length?b.__localize("strong text"):a.text;"**"==c.substr(a.start-2,2)&&"**"==c.substr(a.end,2)?(b.setSelection(a.start-2,a.end+2),b.replaceSelection(d),a=a.start-2):(b.replaceSelection("**"+d+"**"),a=a.start+2);b.setSelection(a,a+d.length)}},{name:"cmdItalic",title:"Italic",hotkey:"Ctrl+I",icon:{glyph:"glyphicon glyphicon-italic",fa:"fa fa-italic","fa-3":"icon-italic"},callback:function(b){var a=b.getSelection();var c=b.getContent();var d=0==a.length?b.__localize("emphasized text"):a.text;"_"==
c.substr(a.start-1,1)&&"_"==c.substr(a.end,1)?(b.setSelection(a.start-1,a.end+1),b.replaceSelection(d),a=a.start-1):(b.replaceSelection("_"+d+"_"),a=a.start+1);b.setSelection(a,a+d.length)}},{name:"cmdHeading",title:"Heading",hotkey:"Ctrl+H",icon:{glyph:"glyphicon glyphicon-header",fa:"fa fa-header","fa-3":"icon-font"},callback:function(b){var a=b.getSelection();var c=b.getContent(),d,e;var m=0==a.length?b.__localize("heading text"):a.text+"\n";(d=4,"### "==c.substr(a.start-d,d))||(d=3,"###"==c.substr(a.start-
d,d))?(b.setSelection(a.start-d,a.end),b.replaceSelection(m),a=a.start-d):0<a.start&&(e=c.substr(a.start-1,1),e&&"\n"!=e)?(b.replaceSelection("\n\n### "+m),a=a.start+6):(b.replaceSelection("### "+m),a=a.start+4);b.setSelection(a,a+m.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",hotkey:"Ctrl+L",icon:{glyph:"glyphicon glyphicon-link",fa:"fa fa-link","fa-3":"icon-link"},callback:function(b){var a=b.getSelection();b.getContent();var c=0==a.length?b.__localize("enter link description here"):
a.text;var d=prompt(b.__localize("Insert Hyperlink"),"http://");null!=d&&""!=d&&"http://"!=d&&"http"==d.substr(0,4)&&(d=e("<div>"+d+"</div>").text(),b.replaceSelection("["+c+"]("+d+")"),a=a.start+1,b.setSelection(a,a+c.length))}},{name:"cmdImage",title:"Image",hotkey:"Ctrl+G",icon:{glyph:"glyphicon glyphicon-picture",fa:"fa fa-picture-o","fa-3":"icon-picture"},callback:function(b){var a=b.getSelection();b.getContent();var c=0==a.length?b.__localize("enter image description here"):a.text;var d=prompt(b.__localize("Insert Image Hyperlink"),
"http://");null!=d&&""!=d&&"http://"!=d&&"http"==d.substr(0,4)&&(d=e("<div>"+d+"</div>").text(),b.replaceSelection("!["+c+"]("+d+' "'+b.__localize("enter image title here")+'")'),a=a.start+2,b.setNextTab(b.__localize("enter image title here")),b.setSelection(a,a+c.length))}}]},{name:"groupMisc",data:[{name:"cmdList",hotkey:"Ctrl+U",title:"Unordered List",icon:{glyph:"glyphicon glyphicon-list",fa:"fa fa-list","fa-3":"icon-list-ul"},callback:function(b){var a=b.getSelection();b.getContent();if(0==a.length){var c=
b.__localize("list text here");b.replaceSelection("- "+c);a=a.start+2}else if(0>a.text.indexOf("\n"))c=a.text,b.replaceSelection("- "+c),a=a.start+2;else{var d=[];d=a.text.split("\n");c=d[0];e.each(d,function(a,b){d[a]="- "+b});b.replaceSelection("\n\n"+d.join("\n"));a=a.start+4}b.setSelection(a,a+c.length)}},{name:"cmdListO",hotkey:"Ctrl+O",title:"Ordered List",icon:{glyph:"glyphicon glyphicon-th-list",fa:"fa fa-list-ol","fa-3":"icon-list-ol"},callback:function(b){var a=b.getSelection();b.getContent();
if(0==a.length){var c=b.__localize("list text here");b.replaceSelection("1. "+c);a=a.start+3}else if(0>a.text.indexOf("\n"))c=a.text,b.replaceSelection("1. "+c),a=a.start+3;else{var d=[];d=a.text.split("\n");c=d[0];e.each(d,function(a,b){d[a]="1. "+b});b.replaceSelection("\n\n"+d.join("\n"));a=a.start+5}b.setSelection(a,a+c.length)}},{name:"cmdCode",hotkey:"Ctrl+K",title:"Code",icon:{glyph:"glyphicon glyphicon-asterisk",fa:"fa fa-code","fa-3":"icon-code"},callback:function(b){var a=b.getSelection();
var c=b.getContent();var d=0==a.length?b.__localize("code text here"):a.text;"`"==c.substr(a.start-1,1)&&"`"==c.substr(a.end,1)?(b.setSelection(a.start-1,a.end+1),b.replaceSelection(d),a=a.start-1):(b.replaceSelection("`"+d+"`"),a=a.start+1);b.setSelection(a,a+d.length)}},{name:"cmdQuote",hotkey:"Ctrl+Q",title:"Quote",icon:{glyph:"glyphicon glyphicon-comment",fa:"fa fa-quote-left","fa-3":"icon-quote-left"},callback:function(b){var a=b.getSelection();b.getContent();if(0==a.length){var c=b.__localize("quote here");
b.replaceSelection("> "+c);a=a.start+2}else if(0>a.text.indexOf("\n"))c=a.text,b.replaceSelection("> "+c),a=a.start+2;else{var d=[];d=a.text.split("\n");c=d[0];e.each(d,function(a,b){d[a]="> "+b});b.replaceSelection("\n\n"+d.join("\n"));a=a.start+4}b.setSelection(a,a+c.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,hotkey:"Ctrl+P",title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:{glyph:"glyphicon glyphicon-search",fa:"fa fa-search","fa-3":"icon-search"},callback:function(b){0==
b.$isPreview?b.showPreview():b.hidePreview()}}]}]],additionalButtons:[],reorderButtonGroups:[],hiddenButtons:[],disabledButtons:[],footer:"",fullscreen:{enable:!0,icons:{fullscreenOn:{fa:"fa fa-expand",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-full"},fullscreenOff:{fa:"fa fa-compress",glyph:"glyphicon glyphicon-fullscreen","fa-3":"icon-resize-small"}}},onShow:function(b){},onPreview:function(b){},onSave:function(b){},onBlur:function(b){},onFocus:function(b){},onChange:function(b){},
onFullscreen:function(b){}};e.fn.markdown.Constructor=p;e.fn.markdown.noConflict=function(){e.fn.markdown=v;return this};var t=function(b){b.data("markdown")?b.data("markdown").showEditor():b.markdown()},w=function(b){var a=e(document.activeElement);e(document).find(".md-editor").each(function(){var b=e(this),d=a.closest(".md-editor")[0]===this;(b=b.find("textarea").data("markdown")||b.find('div[data-provider="markdown-preview"]').data("markdown"))&&!d&&b.blur()})};e(document).on("click.markdown.data-api",
'[data-provide="markdown-editable"]',function(b){t(e(this));b.preventDefault()}).on("click focusin",function(b){w(b)}).ready(function(){e('textarea[data-provide="markdown"]').each(function(){t(e(this))})})}(window.jQuery);