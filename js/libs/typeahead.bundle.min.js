/*
 typeahead.js 0.10.5
 https://github.com/twitter/typeahead.js
 Copyright 2013-2014 Twitter, Inc. and other contributors; Licensed MIT
*/
(function(g){var e=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(b){return!b||/^\s*$/.test(b)},escapeRegExChars:function(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===typeof b},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isPlainObject,isUndefined:function(b){return"undefined"===
typeof b},toStr:function(b){return e.isUndefined(b)||null===b?"":b+""},bind:g.proxy,each:function(b,e){g.each(b,function(b,c){return e(c,b)})},map:g.map,filter:g.grep,every:function(b,e){var d=!0;if(!b)return d;g.each(b,function(c,a){if(!(d=e.call(null,a,c,b)))return!1});return!!d},some:function(b,e){var d=!1;if(!b)return d;g.each(b,function(c,a){if(d=e.call(null,a,c,b))return!1});return!!d},mixin:g.extend,getUniqueId:function(){var b=0;return function(){return b++}}(),templatify:function(b){function e(){return String(b)}
return g.isFunction(b)?b:e},defer:function(b){setTimeout(b,0)},debounce:function(b,e,d){var c,a;return function(){var f=this,k=arguments;var p=d&&!c;clearTimeout(c);c=setTimeout(function(){c=null;d||(a=b.apply(f,k))},e);p&&(a=b.apply(f,k));return a}},throttle:function(b,e){var d,c,a,f;var k=0;var p=function(){k=new Date;a=null;f=b.apply(d,c)};return function(){var l=new Date,m=e-(l-k);d=this;c=arguments;0>=m?(clearTimeout(a),a=null,k=l,f=b.apply(d,c)):a||(a=setTimeout(p,m));return f}},noop:function(){}}}(),
z=function(){function b(c){return(c=e.toStr(c))?c.split(/\s+/):[]}function g(c){return(c=e.toStr(c))?c.split(/\W+/):[]}function d(c){return function(){var a=[].slice.call(arguments,0);return function(f){var k=[];e.each(a,function(a){k=k.concat(c(e.toStr(f[a])))});return k}}}return{nonword:g,whitespace:b,obj:{nonword:d(g),whitespace:d(b)}}}(),u=function(){function b(c){this.maxSize=e.isNumber(c)?c:100;this.reset();0>=this.maxSize&&(this.set=this.get=g.noop)}function h(){this.head=this.tail=null}function d(c,
a){this.key=c;this.val=a;this.prev=this.next=null}e.mixin(b.prototype,{set:function(c,a){var f=this.list.tail;this.size>=this.maxSize&&(this.list.remove(f),delete this.hash[f.key]);(f=this.hash[c])?(f.val=a,this.list.moveToFront(f)):(f=new d(c,a),this.list.add(f),this.hash[c]=f,this.size++)},get:function(c){if(c=this.hash[c])return this.list.moveToFront(c),c.val},reset:function(){this.size=0;this.hash={};this.list=new h}});e.mixin(h.prototype,{add:function(c){this.head&&(c.next=this.head,this.head.prev=
c);this.head=c;this.tail=this.tail||c},remove:function(c){c.prev?c.prev.next=c.next:this.head=c.next;c.next?c.next.prev=c.prev:this.tail=c.prev},moveToFront:function(c){this.remove(c);this.add(c)}});return b}(),A=function(){function b(c){this.prefix=["__",c,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix))}function g(c){return JSON.stringify(e.isUndefined(c)?null:c)}try{var d=window.localStorage;d.setItem("~~~","!");d.removeItem("~~~")}catch(c){d=
null}e.mixin(b.prototype,d&&window.JSON?{_prefix:function(c){return this.prefix+c},_ttlKey:function(c){return this._prefix(c)+this.ttlKey},get:function(c){this.isExpired(c)&&this.remove(c);return JSON.parse(d.getItem(this._prefix(c)))},set:function(c,a,f){e.isNumber(f)?d.setItem(this._ttlKey(c),g((new Date).getTime()+f)):d.removeItem(this._ttlKey(c));return d.setItem(this._prefix(c),g(a))},remove:function(c){d.removeItem(this._ttlKey(c));d.removeItem(this._prefix(c));return this},clear:function(){var c,
a,f=[],k=d.length;for(c=0;c<k;c++)(a=d.key(c)).match(this.keyMatcher)&&f.push(a.replace(this.keyMatcher,""));for(c=f.length;c--;)this.remove(f[c]);return this},isExpired:function(c){c=JSON.parse(d.getItem(this._ttlKey(c)));return e.isNumber(c)&&(new Date).getTime()>c?!0:!1}}:{get:e.noop,set:e.noop,remove:e.noop,clear:e.noop,isExpired:e.noop});return b}(),w=function(){function b(a){a=a||{};this.cancelled=!1;this.lastUrl=null;this._send=a.transport?h(a.transport):g.ajax;this._get=a.rateLimiter?a.rateLimiter(this._get):
this._get;this._cache=!1===a.cache?new u(0):f}function h(a){return function(f,c){var k=g.Deferred();a(f,c,function(a){e.defer(function(){k.resolve(a)})},function(a){e.defer(function(){k.reject(a)})});return k}}var d=0,c={},a=6,f=new u(10);b.setMaxPendingRequests=function(f){a=f};b.resetCache=function(){f.reset()};e.mixin(b.prototype,{_get:function(f,b,e){function k(a){e&&e(null,a);g._cache.set(f,a)}function p(){e&&e(!0)}function l(){d--;delete c[f];g.onDeckRequestArgs&&(g._get.apply(g,g.onDeckRequestArgs),
g.onDeckRequestArgs=null)}var g=this,h;this.cancelled||f!==this.lastUrl||((h=c[f])?h.done(k).fail(p):d<a?(d++,c[f]=this._send(f,b).done(k).fail(p).always(l)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(a,f,c){var k;e.isFunction(f)&&(c=f,f={});this.cancelled=!1;this.lastUrl=a;(k=this._cache.get(a))?e.defer(function(){c&&c(null,k)}):this._get(a,f,c);return!!k},cancel:function(){this.cancelled=!0}});return b}(),B=function(){function b(a){a=a||{};a.datumTokenizer&&a.queryTokenizer||
g.error("datumTokenizer and queryTokenizer are both required");this.datumTokenizer=a.datumTokenizer;this.queryTokenizer=a.queryTokenizer;this.reset()}function h(a){a=e.filter(a,function(a){return!!a});return a=e.map(a,function(a){return a.toLowerCase()})}function d(a){for(var f={},c=[],b=0,d=a.length;b<d;b++)f[a[b]]||(f[a[b]]=!0,c.push(a[b]));return c}function c(a,f){function c(a,f){return a-f}var b=0,d=0,e=[];a=a.sort(c);f=f.sort(c);for(var g=a.length,h=f.length;b<g&&d<h;)a[b]<f[d]?b++:(a[b]>f[d]||
(e.push(a[b]),b++),d++);return e}e.mixin(b.prototype,{bootstrap:function(a){this.datums=a.datums;this.trie=a.trie},add:function(a){var f=this;a=e.isArray(a)?a:[a];e.each(a,function(a){var c=f.datums.push(a)-1;a=h(f.datumTokenizer(a));e.each(a,function(a){var b;var k=f.trie;for(a=a.split("");b=a.shift();)k=k.children[b]||(k.children[b]={ids:[],children:{}}),k.ids.push(c)})})},get:function(a){var f=this,b;a=h(this.queryTokenizer(a));e.each(a,function(a){var k;if(b&&0===b.length)return!1;var d=f.trie;
for(a=a.split("");d&&(k=a.shift());)d=d.children[k];if(d&&0===a.length)d=d.ids.slice(0),b=b?c(b,d):d;else return b=[],!1});return b?e.map(d(b),function(a){return f.datums[a]}):[]},reset:function(){this.datums=[];this.trie={ids:[],children:{}}},serialize:function(){return{datums:this.datums,trie:this.trie}}});return b}(),r=function(){return{local:function(b){return b.local||null},prefetch:function(b){var h={url:null,thumbprint:"",ttl:864E5,filter:null,ajax:{}};if(b=b.prefetch||null)b=e.isString(b)?
{url:b}:b,b=e.mixin(h,b),b.thumbprint="0.10.5"+b.thumbprint,b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",!b.url&&g.error("prefetch requires url to be set");return b},remote:function(b){function h(a){return function(f){return e.debounce(f,a)}}function d(a){return function(f){return e.throttle(f,a)}}var c={url:null,cache:!0,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}};if(b=b.remote||null)b=e.isString(b)?{url:b}:b,b=
e.mixin(c,b),b.rateLimiter=/^throttle$/i.test(b.rateLimitBy)?d(b.rateLimitWait):h(b.rateLimitWait),b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",delete b.rateLimitBy,delete b.rateLimitWait,!b.url&&g.error("remote requires url to be set");return b}}}();(function(b){function h(a){a&&(a.local||a.prefetch||a.remote)||g.error("one of local, prefetch, or remote is required");this.limit=a.limit||5;this.sorter=d(a.sorter);this.dupDetector=a.dupDetector||c;this.local=r.local(a);this.prefetch=
r.prefetch(a);this.remote=r.remote(a);this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null;this.index=new B({datumTokenizer:a.datumTokenizer,queryTokenizer:a.queryTokenizer});this.storage=this.cacheKey?new A(this.cacheKey):null}function d(a){function c(c){return c.sort(a)}function f(a){return a}return e.isFunction(a)?c:f}function c(){return!1}var a=b.Bloodhound;b.Bloodhound=h;h.noConflict=function(){b.Bloodhound=a;return h};h.tokenizers=z;e.mixin(h.prototype,{_loadPrefetch:function(a){function c(c){f.clear();
f.add(a.filter?a.filter(c):c);f._saveToStorage(f.index.serialize(),a.thumbprint,a.ttl)}var f=this,b;(b=this._readFromStorage(a.thumbprint))?(this.index.bootstrap(b),b=g.Deferred().resolve()):b=g.ajax(a.url,a.ajax).done(c);return b},_getFromRemote:function(a,c){var f=this;if(this.transport){a=a||"";var b=encodeURIComponent(a);b=this.remote.replace?this.remote.replace(this.remote.url,a):this.remote.url.replace(this.remote.wildcard,b);return this.transport.get(b,this.remote.ajax,function(a,b){a?c([]):
c(f.remote.filter?f.remote.filter(b):b)})}},_cancelLastRemoteRequest:function(){this.transport&&this.transport.cancel()},_saveToStorage:function(a,c,b){this.storage&&(this.storage.set("data",a,b),this.storage.set("protocol",location.protocol,b),this.storage.set("thumbprint",c,b))},_readFromStorage:function(a){if(this.storage){var c=this.storage.get("data");var f=this.storage.get("protocol");var b=this.storage.get("thumbprint")}a=b!==a||f!==location.protocol;return c&&!a?c:null},_initialize:function(){function a(){c.add(e.isFunction(b)?
b():b)}var c=this,b=this.local;var d=this.prefetch?this._loadPrefetch(this.prefetch):g.Deferred().resolve();b&&d.done(a);this.transport=this.remote?new w(this.remote):null;return this.initPromise=d.promise()},initialize:function(a){return!this.initPromise||a?this._initialize():this.initPromise},add:function(a){this.index.add(a)},get:function(a,c){function f(a){var f=d.slice(0);e.each(a,function(a){!e.some(f,function(c){return b.dupDetector(a,c)})&&f.push(a);return f.length<b.limit});c&&c(b.sorter(f))}
var b=this,d=[],k=!1;d=this.index.get(a);d=this.sorter(d).slice(0,this.limit);d.length<this.limit?k=this._getFromRemote(a,f):this._cancelLastRemoteRequest();k||(0<d.length||!this.transport)&&c&&c(d)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&w.resetCache()},ttAdapter:function(){return e.bind(this.get,this)}});return h})(this);var n=function(){var b={wrapper:{position:"relative",display:"inline-block"},
hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};e.isMsie()&&
e.mixin(b.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});e.isMsie()&&7>=e.isMsie()&&e.mixin(b.input,{marginTop:"-1px"});return b}(),x=function(){function b(b){b&&b.el||g.error("EventBus initialized without el");this.$el=g(b.el)}e.mixin(b.prototype,{trigger:function(b){var d=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+b,d)}});return b}(),t=function(){function b(a,b,e,g){if(!e)return this;b=b.split(c);e=g?d(e,g):e;for(this._callbacks=
this._callbacks||{};g=b.shift();)this._callbacks[g]=this._callbacks[g]||{sync:[],async:[]},this._callbacks[g][a].push(e);return this}function e(a,c,b){return function(){for(var f,d=0,k=a.length;!f&&d<k;d+=1)f=!1===a[d].apply(c,b);return!f}}function d(a,c){return a.bind?a.bind(c):function(){a.apply(c,[].slice.call(arguments,0))}}var c=/\s+/,a=function(){return window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},0)}}();return{onSync:function(a,c,d){return b.call(this,
"sync",a,c,d)},onAsync:function(a,c,d){return b.call(this,"async",a,c,d)},off:function(a){var b;if(!this._callbacks)return this;for(a=a.split(c);b=a.shift();)delete this._callbacks[b];return this},trigger:function(b){var f,d,g;if(!this._callbacks)return this;b=b.split(c);for(g=[].slice.call(arguments,1);(f=b.shift())&&(d=this._callbacks[f]);){var h=e(d.sync,this,[f].concat(g));var v=e(d.async,this,[f].concat(g));h()&&a(v)}return this}}}(),C=function(b){function g(c,a,b){for(var f=[],d=0,g=c.length;d<
g;d++)f.push(e.escapeRegExChars(c[d]));c=b?"\\b("+f.join("|")+")\\b":"("+f.join("|")+")";return a?new RegExp(c):new RegExp(c,"i")}var d={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(c){function a(c,b){for(var f,d=0;d<c.childNodes.length;d++)f=c.childNodes[d],3===f.nodeType?d+=b(f)?1:0:a(f,b)}c=e.mixin({},d,c);if(c.node&&c.pattern){c.pattern=e.isArray(c.pattern)?c.pattern:[c.pattern];var f=g(c.pattern,c.caseSensitive,c.wordsOnly);a(c.node,function(a){var d;
if(d=f.exec(a.data)){var e=b.createElement(c.tagName);c.className&&(e.className=c.className);var k=a.splitText(d.index);k.splitText(d[0].length);e.appendChild(k.cloneNode(!0));a.parentNode.replaceChild(e,k)}return!!d})}}}(window.document),y=function(){function b(a){var b=this;a=a||{};a.input||g.error("input is missing");var d=e.bind(this._onBlur,this);var p=e.bind(this._onFocus,this);var l=e.bind(this._onKeydown,this);var m=e.bind(this._onInput,this);this.$hint=g(a.hint);this.$input=g(a.input).on("blur.tt",
d).on("focus.tt",p).on("keydown.tt",l);0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop);if(e.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){c[a.which||a.keyCode]||e.defer(e.bind(b._onInput,b,a))});else this.$input.on("input.tt",m);this.query=this.$input.val();this.$overflowHelper=h(this.$input)}function h(a){return g('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",whiteSpace:"pre",fontFamily:a.css("font-family"),
fontSize:a.css("font-size"),fontStyle:a.css("font-style"),fontVariant:a.css("font-variant"),fontWeight:a.css("font-weight"),wordSpacing:a.css("word-spacing"),letterSpacing:a.css("letter-spacing"),textIndent:a.css("text-indent"),textRendering:a.css("text-rendering"),textTransform:a.css("text-transform")}).insertAfter(a)}function d(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey}var c={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};b.normalizeQuery=function(a){return(a||"").replace(/^\s*/g,
"").replace(/\s{2,}/g," ")};e.mixin(b.prototype,t,{_onBlur:function(){this.resetInputValue();this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(a){var b=c[a.which||a.keyCode];this._managePreventDefault(b,a);b&&this._shouldTrigger(b,a)&&this.trigger(b+"Keyed",a)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(a,c){switch(a){case "tab":var b=this.getHint();var f=this.getInputValue();b=b&&b!==f&&!d(c);break;case "up":case "down":b=!d(c);
break;default:b=!1}b&&c.preventDefault()},_shouldTrigger:function(a,c){switch(a){case "tab":var b=!d(c);break;default:b=!0}return b},_checkInputValue:function(){var a=this.getInputValue();var c=this.query;var d=(c=b.normalizeQuery(a)===b.normalizeQuery(c))?this.query.length!==a.length:!1;this.query=a;c?d&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},getQuery:function(){return this.query},
setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,c){this.$input.val(a);c?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(a){this.$hint.val(a)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var a=this.getInputValue();var c=this.getHint();c=a!==c&&0===c.indexOf(a);""!==a&&c&&!this.hasOverflow()||this.clearHint()},
getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var a=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a=this.$input.val().length;var c=this.$input[0].selectionStart;return e.isNumber(c)?c===a:document.selection?(c=document.selection.createRange(),c.moveStart("character",-a),a===c.text.length):!0},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");
this.$hint=this.$input=this.$overflowHelper=null}});return b}(),q=function(){function b(c){c=c||{};c.templates=c.templates||{};c.source||g.error("missing source");c.name&&!/^[_a-zA-Z0-9-]+$/.test(c.name)&&g.error("invalid dataset name: "+c.name);this.query=null;this.highlight=!!c.highlight;this.name=c.name||e.getUniqueId();this.source=c.source;this.displayFn=h(c.display||c.displayKey);this.templates=d(c.templates,this.displayFn);this.$el=g('<div class="tt-dataset-%CLASS%"></div>'.replace("%CLASS%",
this.name))}function h(c){function a(a){return a[c]}c=c||"value";return e.isFunction(c)?c:a}function d(c,a){function b(c){return"<p>"+a(c)+"</p>"}return{empty:c.empty&&e.templatify(c.empty),header:c.header&&e.templatify(c.header),footer:c.footer&&e.templatify(c.footer),suggestion:c.suggestion||b}}b.extractDatasetName=function(c){return g(c).data("ttDataset")};b.extractValue=function(c){return g(c).data("ttValue")};b.extractDatum=function(c){return g(c).data("ttDatum")};e.mixin(b.prototype,t,{_render:function(c,
a){function b(){var b=g('<span class="tt-suggestions"></span>').css(n.suggestions);var d=e.map(a,function(a){a=g('<div class="tt-suggestion"></div>').append(l.templates.suggestion(a)).data("ttDataset",l.name).data("ttValue",l.displayFn(a)).data("ttDatum",a);a.children().each(function(){g(this).css(n.suggestionChild)});return a});b.append.apply(b,d);l.highlight&&C({className:"tt-highlight",node:b[0],pattern:c});return b}function d(){return l.templates.header({query:c,isEmpty:!m})}function h(){return l.templates.footer({query:c,
isEmpty:!m})}if(this.$el){var l=this;this.$el.empty();var m=a&&a.length;!m&&this.templates.empty?this.$el.html(l.templates.empty({query:c,isEmpty:!0})).prepend(l.templates.header?d():null).append(l.templates.footer?h():null):m&&this.$el.html(b()).prepend(l.templates.header?d():null).append(l.templates.footer?h():null);this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(c){var a=this;this.query=c;this.canceled=!1;this.source(c,function(b){a.canceled||c!==a.query||a._render(c,
b)})},cancel:function(){this.canceled=!0},clear:function(){this.cancel();this.$el.empty();this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}});return b}(),D=function(){function b(b){var c=this;b=b||{};b.menu||g.error("menu is required");this.isOpen=!1;this.isEmpty=!0;this.datasets=e.map(b.datasets,h);var a=e.bind(this._onSuggestionClick,this);var d=e.bind(this._onSuggestionMouseEnter,this);var k=e.bind(this._onSuggestionMouseLeave,this);this.$menu=
g(b.menu).on("click.tt",".tt-suggestion",a).on("mouseenter.tt",".tt-suggestion",d).on("mouseleave.tt",".tt-suggestion",k);e.each(this.datasets,function(a){c.$menu.append(a.getRoot());a.onSync("rendered",c._onRendered,c)})}function h(b){return new q(b)}e.mixin(b.prototype,t,{_onSuggestionClick:function(b){this.trigger("suggestionClicked",g(b.currentTarget))},_onSuggestionMouseEnter:function(b){this._removeCursor();this._setCursor(g(b.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},
_onRendered:function(){(this.isEmpty=e.every(this.datasets,function(b){return b.isEmpty()}))?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(b,c){b.first().addClass("tt-cursor");!c&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},
_moveCursor:function(b){if(this.isOpen){var c=this._getCursor();var a=this._getSuggestions();this._removeCursor();b=a.index(c)+b;b=(b+1)%(a.length+1)-1;-1===b?this.trigger("cursorRemoved"):(-1>b&&(b=a.length-1),this._setCursor(a=a.eq(b)),this._ensureVisible(a))}},_ensureVisible:function(b){var c=b.position().top;b=c+b.outerHeight(!0);var a=this.$menu.scrollTop();var d=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);0>c?this.$menu.scrollTop(a+
c):d<b&&this.$menu.scrollTop(a+(b-d))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(b){this.$menu.css("ltr"===b?n.ltr:n.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},getDatumForSuggestion:function(b){var c=null;b.length&&(c={raw:q.extractDatum(b),value:q.extractValue(b),
datasetName:q.extractDatasetName(b)});return c},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(b){e.each(this.datasets,function(c){c.update(b)})},empty:function(){e.each(this.datasets,function(b){b.clear()});this.isEmpty=!0},isVisible:function(){return this.isOpen&&!this.isEmpty},destroy:function(){this.$menu.off(".tt");this.$menu=null;
e.each(this.datasets,function(b){b.destroy()})}});return b}(),E=function(){function b(a){a=a||{};a.input||g.error("missing input");this.isActivated=!1;this.autoselect=!!a.autoselect;this.minLength=e.isNumber(a.minLength)?a.minLength:1;this.$node=h(a.input,a.withHint);var b=this.$node.find(".tt-dropdown-menu");var c=this.$node.find(".tt-input");var d=this.$node.find(".tt-hint");c.on("blur.tt",function(a){var d=document.activeElement;var f=b.is(d);d=0<b.has(d).length;e.isMsie()&&(f||d)&&(a.preventDefault(),
a.stopImmediatePropagation(),e.defer(function(){c.focus()}))});b.on("mousedown.tt",function(a){a.preventDefault()});this.eventBus=a.eventBus||new x({el:c});this.dropdown=(new D({menu:b,datasets:a.datasets})).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=
(new y({input:c,hint:d})).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,this).onSync("whitespaceChanged",this._onWhitespaceChanged,
this);this._setLanguageDirection()}function h(a,b){var c=g(a);var f=g('<span class="twitter-typeahead"></span>').css(n.wrapper);var e=g('<span class="tt-dropdown-menu"></span>').css(n.dropdown);var h=c.clone().css(n.hint).css(d(c));h.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1});c.data("ttAttrs",{dir:c.attr("dir"),autocomplete:c.attr("autocomplete"),spellcheck:c.attr("spellcheck"),style:c.attr("style")});
c.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(b?n.input:n.inputWithNoHint);try{!c.attr("dir")&&c.attr("dir","auto")}catch(v){}return c.wrap(f).parent().prepend(b?h:null).append(e)}function d(a){return{backgroundAttachment:a.css("background-attachment"),backgroundClip:a.css("background-clip"),backgroundColor:a.css("background-color"),backgroundImage:a.css("background-image"),backgroundOrigin:a.css("background-origin"),backgroundPosition:a.css("background-position"),backgroundRepeat:a.css("background-repeat"),
backgroundSize:a.css("background-size")}}function c(a){var c=a.find(".tt-input");e.each(c.data("ttAttrs"),function(a,b){e.isUndefined(a)?c.removeAttr(b):c.attr(b,a)});c.detach().removeData("ttAttrs").removeClass("tt-input").insertAfter(a);a.remove()}e.mixin(b.prototype,{_onSuggestionClicked:function(a,c){var b;(b=this.dropdown.getDatumForSuggestion(c))&&this._select(b)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.setInputValue(a.value,!0);this.eventBus.trigger("cursorchanged",
a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint();this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0;this.dropdown.open()},_onBlurred:function(){this.isActivated=!1;this.dropdown.empty();this.dropdown.close()},_onEnterKeyed:function(a,c){var b=this.dropdown.getDatumForCursor();
var d=this.dropdown.getDatumForTopSuggestion();b?(this._select(b),c.preventDefault()):this.autoselect&&d&&(this._select(d),c.preventDefault())},_onTabKeyed:function(a,c){var b;(b=this.dropdown.getDatumForCursor())?(this._select(b),c.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorUp();
this.dropdown.open()},_onDownKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorDown();this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,c){this.input.clearHintIfInvalid();c.length>=this.minLength?this.dropdown.update(c):this.dropdown.empty();this.dropdown.open();this._setLanguageDirection()},
_onWhitespaceChanged:function(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},_updateHint:function(){var a;if((a=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()){var c=this.input.getInputValue();var b=y.normalizeQuery(c);b=e.escapeRegExChars(b);b=new RegExp("^(?:"+b+")(.+$)","i");(a=b.exec(a.value))?
this.input.setHint(c+a[1]):this.input.clearHint()}else this.input.clearHint()},_autocomplete:function(a){var c=this.input.getHint();var b=this.input.getQuery();a=a||this.input.isCursorAtEnd();c&&b!==c&&a&&((c=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(c.value),this.eventBus.trigger("autocompleted",c.raw,c.datasetName))},_select:function(a){this.input.setQuery(a.value);this.input.setInputValue(a.value,!0);this._setLanguageDirection();this.eventBus.trigger("selected",a.raw,
a.datasetName);this.dropdown.close();e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(a){a=e.toStr(a);this.isActivated?this.input.setInputValue(a):(this.input.setQuery(a),this.input.setInputValue(a,!0));this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy();this.dropdown.destroy();c(this.$node);this.$node=null}});return b}();(function(){var b=
g.fn.typeahead;var h={initialize:function(b,c){c=e.isArray(c)?c:[].slice.call(arguments,1);b=b||{};return this.each(function(){var a=g(this);e.each(c,function(a){a.highlight=!!b.highlight});var d=new E({input:a,eventBus:new x({el:a}),withHint:e.isUndefined(b.hint)?!0:!!b.hint,minLength:b.minLength,autoselect:b.autoselect,datasets:c});a.data("ttTypeahead",d)})},open:function(){return this.each(function(){var b;(b=g(this).data("ttTypeahead"))&&b.open()})},close:function(){return this.each(function(){var b;
(b=g(this).data("ttTypeahead"))&&b.close()})},val:function(b){function c(){var a;(a=g(this).data("ttTypeahead"))&&a.setVal(b)}function a(a){if(a=a.data("ttTypeahead"))var b=a.getVal();return b}return arguments.length?this.each(c):a(this.first())},destroy:function(){return this.each(function(){var b=g(this),c;if(c=b.data("ttTypeahead"))c.destroy(),b.removeData("ttTypeahead")})}};g.fn.typeahead=function(b){if(h[b]&&"initialize"!==b){var c=this.filter(function(){return!!g(this).data("ttTypeahead")});
return h[b].apply(c,[].slice.call(arguments,1))}return h.initialize.apply(this,arguments)};g.fn.typeahead.noConflict=function(){g.fn.typeahead=b;return this}})()})(window.jQuery);